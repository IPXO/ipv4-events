<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <!-- Make every URL relative to /docs for GitHub Pages project sites -->
  <base href="./">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ipv4.events — The IPv4 Era</title>
  <meta name="description" content="A Windows 95–style timeline of technology during the IPv4 era: standards, OSes, programming, browsers, mobile, security & policy, finance & markets, cloud, serverless, edge, CDNs, data centers, satellites, space, and more."/>
  <style>
    :root{
      --desk:#008080; --win:#c0c0c0; --br:#808080; --txt:#000;
      --shadow-in: inset -2px -2px 0 #fff, inset 2px 2px 0 #808080;
      --chip:#e9e9e9;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--desk);color:var(--txt);font-family:Tahoma,Segoe UI,Arial,sans-serif}
    .container{max-width:1220px;margin:0 auto;padding:0 14px}
    .panel{background:var(--win);border:4px solid var(--br);box-shadow:var(--shadow-in)}
    header.top{position:sticky;top:0;z-index:5;background:var(--win);border-bottom:4px solid var(--br);box-shadow:var(--shadow-in)}
    .top-inner{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 14px}
    .brand{display:flex;gap:8px;align-items:center;font-weight:700}
    img.icon{width:18px;height:18px;image-rendering:pixelated}
    .controls{display:flex;flex-wrap:wrap;gap:8px}
    .input,.select{border:2px solid #000;background:#fff;padding:7px 10px;font-size:14px}
    .input{min-width:260px}
    main{padding:16px 0}
    .hero{padding:14px;margin-bottom:16px}
    .hero h2{margin:0 0 6px;font-size:18px;display:flex;gap:8px;align-items:center}
    .muted{opacity:.9;font-size:13px}
    .catbar{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .cat-pill{display:flex;align-items:center;gap:6px;background:#fff;border:2px solid #000;padding:5px 8px;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin:18px 0 60px}
    @media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
    @media(min-width:1200px){.grid{grid-template-columns:1fr 1fr 1fr}}
    .year-card{overflow:hidden}
    .year-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:4px solid var(--br);background:#d6d6d6}
    .year-title{display:flex;gap:8px;align-items:center;font-weight:700}
    .event-list{list-style:none;margin:0;padding:10px 12px;display:flex;flex-direction:column;gap:10px}
    .event{display:grid;grid-template-columns:20px auto;gap:8px}
    .event-title{font-weight:700}
    .chip-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
    .chip{background:var(--chip);border:1px solid #000;padding:1px 6px;font-size:11px;display:inline-flex;align-items:center;gap:4px;cursor:pointer}
    footer{margin:26px 0 80px;padding:14px}
  </style>
</head>
<body>
  <header class="top">
    <div class="top-inner container">
      <div class="brand"><img id="ico-computer" class="icon" alt=""/> ipv4.events — The IPv4 Era</div>
      <div class="controls">
        <input id="q" class="input" placeholder="Search titles, hashtags, years…">
        <select id="cat" class="select"></select>
        <select id="dec" class="select">
          <option value="">All decades</option>
          <option>1950s</option><option>1960s</option><option>1970s</option><option>1980s</option>
          <option>1990s</option><option>2000s</option><option>2010s</option><option>2020s</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero panel">
      <h2><img id="ico-world" class="icon" alt=""/> From ARPANET to Dual-Stack — and Beyond</h2>
      <p class="muted">
        A Windows 95–style timeline of technological milestones across the IPv4 era:
        standards, operating systems, programming, browsers, mobile & wireless, security & policy, finance & markets,
        cloud, serverless, edge, CDNs, data centers, submarine cables, IXPs/NOGs, AI, space, satellite internet, and more.
        Filter by category, decade, or keyword; click a hashtag to search.
      </p>
      <div id="catbar" class="catbar"></div>
    </section>

    <section id="years" class="grid"></section>

    <footer class="panel">
      <strong style="display:flex;align-items:center;gap:8px"><img id="ico-info" class="icon" alt=""/> About</strong>
      <p class="muted">Built by IPXO & contributors. Data lives in <code>docs/data/</code>. Contributions welcome — see README & CONTRIBUTING.</p>
    </footer>
  </main>

  <script>
  // --- icon paths (relative) ---
  const ICONS = {
    computer: "icons/computer.ico",
    world: "icons/world.ico",
    folder: "icons/folder.ico",
    info: "icons/help.ico"
  };
  // header icons
  const elPC = document.getElementById("ico-computer"); if (elPC) elPC.src = ICONS.computer;
  const elWorld = document.getElementById("ico-world"); if (elWorld) elWorld.src = ICONS.world;
  const elInfo = document.getElementById("ico-info"); if (elInfo) elInfo.src = ICONS.info;

  // decade helper
  function decadeOf(y){
    if (y<1960) return "1950s";
    if (y<1970) return "1960s";
    if (y<1980) return "1970s";
    if (y<1990) return "1980s";
    if (y<2000) return "1990s";
    if (y<2010) return "2000s";
    if (y<2020) return "2010s";
    return "2020s";
  }

  // state
  let CATS = [];
  let ALL = [];

  // normalize potential leading slash in iconUrl (contributors sometimes add "/icons/...").
  function normPath(p){ return (p||"").replace(/^\/+/,""); }

  async function loadCategories(){
    const res = await fetch("data/categories.json");
    if(!res.ok) throw new Error("Failed to load data/categories.json");
    CATS = await res.json();

    // Fill category select
    const sel = document.getElementById("cat");
    sel.innerHTML = '<option value="">All categories</option>' +
      CATS.map(c=>`<option value="${c.id}">${c.label}</option>`).join("");

    // Category pill bar
    const bar = document.getElementById("catbar");
    bar.innerHTML = CATS.map(c =>
      `<button class="cat-pill" data-cat="${c.id}" title="${c.group}">
        <img class="icon" src="${normPath(c.iconUrl)}" alt=""/> ${c.label}
      </button>`).join("");
    bar.querySelectorAll(".cat-pill").forEach(b=>{
      b.addEventListener("click",()=>{ document.getElementById("cat").value=b.dataset.cat; render(); });
    });
  }

  async function loadAllEventsViaManifest(){
    const base = "data/events/";
    const m = await fetch(base + "manifest.json");
    if(!m.ok) throw new Error("Failed to load data/events/manifest.json");
    const files = await m.json();
    const loads = files.map(f => fetch(base + f).then(r => r.ok ? r.json() : []).catch(()=>[]));
    const chunks = await Promise.all(loads);
    return chunks.flat();
  }

  function matchesFilter(ev, q, cat, dec){
    const text = (ev.title+" "+(ev.overview||"")+" "+(ev.hashtags||[]).join(" ")).toLowerCase();
    const okQ = !q || text.includes(q) || String(ev.year).includes(q);
    const okCat = !cat || (ev.categories||[]).includes(cat);
    const okDec = !dec || decadeOf(ev.year)===dec;
    return okQ && okCat && okDec;
  }

  function render(){
    const q = (document.getElementById("q").value||"").toLowerCase();
    const cat = document.getElementById("cat").value;
    const dec = document.getElementById("dec").value;

    const filtered = ALL.filter(e=>matchesFilter(e,q,cat,dec));
    const byYear = {};
    filtered.forEach(e => { (byYear[e.year] = byYear[e.year] || []).push(e); });
    const years = Object.keys(byYear).map(n=>+n).sort((a,b)=>a-b);

    const root = document.getElementById("years");
    root.innerHTML = "";
    if (!years.length){
      const empty = document.createElement("div");
      empty.className = "panel";
      empty.style.padding = "14px";
      empty.textContent = "No events match your filters.";
      root.appendChild(empty);
      return;
    }

    years.forEach(y=>{
      const card = document.createElement("section"); card.className="year-card panel";
      const head = document.createElement("div"); head.className="year-head";
      head.innerHTML = `<div class="year-title"><img class="icon" src="${ICONS.folder}" alt=""/> ${y}</div><div>${decadeOf(y)}</div>`;
      const ul = document.createElement("ul"); ul.className="event-list";

      // sort by category then title for stable view
      byYear[y].sort((a,b)=>(a.categories?.[0]||"").localeCompare(b.categories?.[0]||"")||a.title.localeCompare(b.title));

      byYear[y].forEach(e=>{
        const li = document.createElement("li"); li.className="event";
        const img = document.createElement("img"); img.className="icon";
        const catId = (e.categories||[])[0];
        const catObj = CATS.find(c=>c.id===catId);
        img.src = catObj ? normPath(catObj.iconUrl) : ICONS.folder;

        const body = document.createElement("div");
        const title = document.createElement("div"); title.className="event-title"; title.textContent = e.title;
        const overview = document.createElement("div"); overview.className="muted"; overview.textContent = e.overview || "";

        const chips = document.createElement("div"); chips.className="chip-row";
        (e.hashtags||[]).forEach(h=>{
          const c = document.createElement("span"); c.className="chip"; c.textContent="#"+h;
          c.addEventListener("click",()=>{ document.getElementById("q").value = h; render(); });
          chips.appendChild(c);
        });

        body.appendChild(title); body.appendChild(overview); body.appendChild(chips);
        li.appendChild(img); li.appendChild(body); ul.appendChild(li);
      });

      card.appendChild(head); card.appendChild(ul); root.appendChild(card);
    });
  }

  (async function start(){
    try{
      await loadCategories();
      ALL = await loadAllEventsViaManifest();

      // bind inputs
      document.getElementById("q").addEventListener("input", render);
      document.getElementById("cat").addEventListener("change", render);
      document.getElementById("dec").addEventListener("change", render);

      render();
    }catch(e){
      console.error(e);
      const yearsEl = document.getElementById("years");
      if (yearsEl){
        yearsEl.innerHTML = `<div class="panel" style="padding:14px">Error loading data. Check console & paths.</div>`;
      }
    }
  })();
  </script>
</body>
</html>